<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Página Inicial</title>
    <link rel="stylesheet" href="public/styles/main.css"/>
    <link rel="stylesheet" href="public/styles/user-page.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Lexend+Deca"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
      integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="js/register.js"></script>
  </head>

  <body>
    <header>
      <div id="elipses">
        <div id="elipse1">
          <div id="elipse2">
            <div id="elipse3">e3</div>
          </div>
        </div>
      </div>
      <form id="searchBar">
        <input
          type="text"
          placeholder="O que você está procurando?"
          name="search"
        />
        <button id="btnSearch">
          <i style="width: 24px" class="fa-solid fa-magnifying-glass"></i>
        </button>
      </form>
      <div id="icons">
        <i class="fa-solid fa-user" onclick="logout()" id="user"></i>
        <i class="fa-solid fa-cart-shopping"></i>
      </div>
    </header>
    <main>
      <h1>Bem Vindo,<span id="personName">Pessoa</span></h1>
      <div id="boxCenter">
        <img src="public/images/material-symbols_emergency-home.png" />
        <p>
          Teremos uma palestra em <span id="city">São José dos Campos</span> no
          dia <span id="data">26 de Agosto</span>.
        </p>
        <p>
          <span>Aproveite agora essa oportunidade</span> e adquira já seu
          ingresso.
        </p>
      </div>
      <button class="btnSecondary">Adquirir Ingressos</button>
      <a href="">Continuar para o site</a>
    </main>
    <img id="vectorsImage" src="public/images/Vectors2.png" />
  </body>
  <script>
    if (sessionStorage.getItem("user") || localStorage.getItem("user")) {
      var user = sessionStorage.getItem("user")
        ? sessionStorage.getItem("user")
        : localStorage.getItem("user");
      user = JSON.parse(user);
      document.getElementById("personName").innerHTML =
        user.name + " " + user.surname;
    } else {
      location.href = "login.html";
    }
    var events;
    fetch("http://127.0.0.1:3000/getEvents")
      .then((res) => res.json())
      .then((res) => {
        events = res;

        events = events.sort(function (a, b) {
          return new Date(b.data) - new Date(a.data);
        });
        document.getElementById("city").innerHTML = events[0].local;
        document.getElementById("data").innerHTML = events[0].data;

        filterQuery();
      });

    const filterQuery = () => {
      let params = new URLSearchParams(location.search);
      let search = params.get("search");
      let selected = events.filter(
        (el) =>
          el.local.toLowerCase().indexOf(search.toLowerCase()) > -1 ||
          el.data.toLowerCase().indexOf(search.toLowerCase()) > -1
      );
      selected = selected.map((el) => el.data + " - " + el.local);
      let text = selected.join("/n");
      if (search) {
        alert(text);
      }
    };

    const logout = () => {
      sessionStorage.removeItem("user");
      localStorage.removeItem("user");

      location.href = "/login.html";
    };
  </script>
</html>
